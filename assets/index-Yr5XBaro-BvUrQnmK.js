import{i as Cn,a as In,d as Ve}from"./index-D6fLMv29-COUJrQhB.js";import{b as Ue,d as Je,f as Ut,y as Ln,z as Wn,h as rt,u as Tn,A as Sn,B as En,C as Bn,D as Hn,E as xn,F as Rn,G as An,H as Dn,I as On,J as Pn,K as Nn,L as Gn,w as Fn,M as qn,N as zn,O as Kn}from"./functions-Bsik6ikd-CD340WZ-.js";import{a as Pe,u as Vn,b as V}from"./hooks-C5oewugr.js";import{h as Mt,a as Qe,c as Ye,P as Xe,t as Ze,N as Ne,L as $,w as Un,x as _t,q as Jn,T as Yt,y as Qn,p as Yn,z as je,A as Xn,C as Zn,H as U,E as jn,G as ts,O as es,I as ns,M as ss,W as Ge,J as as,K as os}from"./MilkdownEditor-CQzOidG1.js";import{t as ls}from"./index-n7wNYmDo.js";import{f as tn,o as en,c as nn}from"./floating-ui.dom-DJfcjnnZ.js";import{b as is}from"./index.es-CoLl5MKs.js";import"./index-Bso2Fy82.js";import"./mutex-yV3mxE7x.js";var sn=n=>{throw TypeError(n)},Xt=(n,t,e)=>t.has(n)||sn("Cannot "+e),l=(n,t,e)=>(Xt(n,t,"read from private field"),e?e.call(n):t.get(n)),k=(n,t,e)=>t.has(n)?sn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),p=(n,t,e,a)=>(Xt(n,t,"write to private field"),t.set(n,e),e),rs=(n,t,e)=>(Xt(n,t,"access private method"),e);function Nt(n,t){return Object.assign(n,{meta:{package:"@milkdown/plugin-block",...t}}),n}const ds=n=>!Ze(t=>t.type.name==="table")(n),st=Mt({filterNodes:ds},"blockConfig");Nt(st,{displayName:"Ctx<blockConfig>"});function cs(n,t,e){var a;if(!n.dom.parentElement)return null;try{const s=(a=n.posAtCoords({left:t.x,top:t.y}))==null?void 0:a.inside;if(s==null||s<0)return null;let o=n.state.doc.resolve(s),r=n.state.doc.nodeAt(s),u=n.nodeDOM(s);const c=_=>{const b=o.depth>=1&&o.index(o.depth)===0;if(!(_||b))return;const C=o.before(o.depth);r=n.state.doc.nodeAt(C),u=n.nodeDOM(C),o=n.state.doc.resolve(C),e(o,r)||c(!0)},y=e(o,r);return c(!y),!u||!r?null:{node:r,$pos:o,el:u}}catch{return null}}let Fe=null;function us(){return Fe||(Fe=document.implementation.createHTMLDocument("title"))}const hs={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};function ps(n,t){const e=[];let{openStart:a,openEnd:s,content:o}=t;for(;a>1&&s>1&&o.childCount===1&&o.firstChild.childCount===1;){a-=1,s-=1;const M=o.firstChild;e.push(M.type.name,M.attrs!==M.type.defaultAttrs?M.attrs:null),o=M.content}const r=n.someProp("clipboardSerializer")||Un.fromSchema(n.state.schema),u=us(),c=u.createElement("div");c.appendChild(r.serializeFragment(o,{document:u}));let y=c.firstChild,_,b=0;for(;y&&y.nodeType===1&&(_=hs[y.nodeName.toLowerCase()]);){for(let M=_.length-1;M>=0;M--){const W=u.createElement(_[M]);for(;c.firstChild;)W.appendChild(c.firstChild);c.appendChild(W),b++}y=c.firstChild}y&&y.nodeType===1&&y.setAttribute("data-pm-slice",`${a} ${s}${b?` -${b}`:""} ${JSON.stringify(e)}`);const C=n.someProp("clipboardTextSerializer",M=>M(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:c,text:C}}const qe=_t.ie&&_t.ie_version<15||_t.ios&&_t.webkit_version<604,ze=20;var yt,Ct,J,R,dt,A,q,an,ct,Q,Y,It,ut,ht,pt,Lt,X;class ms{constructor(){k(this,q),k(this,yt),k(this,Ct),k(this,J),k(this,R),k(this,dt),k(this,A),k(this,Q),k(this,Y),k(this,It),k(this,ut),k(this,ht),k(this,pt),k(this,Lt),k(this,X),p(this,Ct,()=>{if(!l(this,R))return null;const t=l(this,R),e=l(this,q,ct);if(e&&Ne.isSelectable(t.node)){const a=Ne.create(e.state.doc,t.$pos.pos);return e.dispatch(e.state.tr.setSelection(a)),e.focus(),p(this,J,a),a}return null}),p(this,J,null),p(this,R,null),p(this,dt,void 0),p(this,A,!1),p(this,Y,()=>{var t;(t=l(this,Q))==null||t.call(this,{type:"hide"}),p(this,R,null)}),p(this,It,t=>{var e;p(this,R,t),(e=l(this,Q))==null||e.call(this,{type:"show",active:t})}),this.bind=(t,e)=>{p(this,yt,t),p(this,Q,e)},this.addEvent=t=>{t.addEventListener("mousedown",l(this,ut)),t.addEventListener("mouseup",l(this,ht)),t.addEventListener("dragstart",l(this,pt))},this.removeEvent=t=>{t.removeEventListener("mousedown",l(this,ut)),t.removeEventListener("mouseup",l(this,ht)),t.removeEventListener("dragstart",l(this,pt))},this.unBind=()=>{p(this,Q,void 0)},p(this,ut,()=>{var t;p(this,dt,(t=l(this,R))==null?void 0:t.el.getBoundingClientRect()),l(this,Ct).call(this)}),p(this,ht,()=>{if(!l(this,A)){requestAnimationFrame(()=>{var t;l(this,dt)&&((t=l(this,q,ct))==null||t.focus())});return}p(this,A,!1),p(this,J,null)}),p(this,pt,t=>{var e;p(this,A,!0);const a=l(this,q,ct);if(!a)return;a.dom.dataset.dragging="true";const s=l(this,J);if(t.dataTransfer&&s){const o=s.content();t.dataTransfer.effectAllowed="copyMove";const{dom:r,text:u}=ps(a,o);t.dataTransfer.clearData(),t.dataTransfer.setData(qe?"Text":"text/html",r.innerHTML),qe||t.dataTransfer.setData("text/plain",u);const c=(e=l(this,R))==null?void 0:e.el;c&&t.dataTransfer.setDragImage(c,0,0),a.dragging={slice:o,move:!0}}}),this.keydownCallback=t=>(l(this,Y).call(this),p(this,A,!1),t.dom.dataset.dragging="false",!1),p(this,Lt,ls((t,e)=>{if(!t.editable)return;const a=t.dom.getBoundingClientRect(),s=a.left+a.width/2;if(!(t.root.elementFromPoint(s,e.clientY)instanceof Element)){l(this,Y).call(this);return}const o=l(this,q,an);if(!o)return;const r=cs(t,{x:s,y:e.clientY},o);if(!r){l(this,Y).call(this);return}l(this,It).call(this,r)},200)),this.mousemoveCallback=(t,e)=>(t.composing||!t.editable||l(this,Lt).call(this,t,e),!1),this.dragoverCallback=(t,e)=>{var a;if(l(this,A)){const s=(a=l(this,q,ct))==null?void 0:a.dom.parentElement;if(!s)return!1;const o=s.scrollHeight>s.clientHeight,r=s.getBoundingClientRect();if(o){if(s.scrollTop>0&&Math.abs(e.y-r.y)<ze){const c=s.scrollTop>10?s.scrollTop-10:0;return s.scrollTop=c,!1}const u=Math.round(t.dom.getBoundingClientRect().height);if(Math.round(s.scrollTop+r.height)<u&&Math.abs(e.y-(r.height+r.y))<ze){const c=s.scrollTop+10;return s.scrollTop=c,!1}}}return!1},this.dragenterCallback=t=>{t.dragging&&(p(this,A,!0),t.dom.dataset.dragging="true")},this.dragleaveCallback=(t,e)=>{const a=e.clientX,s=e.clientY;(a<0||s<0||a>window.innerWidth||s>window.innerHeight)&&(p(this,R,null),l(this,X).call(this,t))},this.dropCallback=t=>(l(this,X).call(this,t),!1),this.dragendCallback=t=>{l(this,X).call(this,t)},p(this,X,t=>{p(this,A,!1),t.dom.dataset.dragging="false"})}}yt=new WeakMap,Ct=new WeakMap,J=new WeakMap,R=new WeakMap,dt=new WeakMap,A=new WeakMap,q=new WeakSet,an=function(){var n;return(n=l(this,yt))==null?void 0:n.get(st.key).filterNodes},ct=function(){var n;return(n=l(this,yt))==null?void 0:n.get($)},Q=new WeakMap,Y=new WeakMap,It=new WeakMap,ut=new WeakMap,ht=new WeakMap,pt=new WeakMap,Lt=new WeakMap,X=new WeakMap;const Zt=Mt(new ms,"blockService");Nt(st,{displayName:"Ctx<blockService>"});const jt=Mt({},"blockSpec");Nt(st,{displayName:"Ctx<blockSpec>"});const te=Qe(n=>{const t=new Ye("MILKDOWN_BLOCK"),e=n.get(Zt.key),a=n.get(jt.key);return new Xe({key:t,...a,props:{...a.props,handleDOMEvents:{drop:s=>e.dropCallback(s),pointermove:(s,o)=>e.mousemoveCallback(s,o),keydown:s=>e.keydownCallback(s),dragover:(s,o)=>e.dragoverCallback(s,o),dragleave:(s,o)=>e.dragleaveCallback(s,o),dragenter:s=>e.dragenterCallback(s),dragend:s=>e.dragendCallback(s)}}})});Nt(te,{displayName:"Prose<block>"});var T,P,et,nt,Pt,mt,Wt,Tt,vt,wt,ft,Jt,on;class vs{constructor(t){k(this,Jt),k(this,T),k(this,P),k(this,et),k(this,nt),k(this,Pt),k(this,mt),k(this,Wt),k(this,Tt),k(this,vt),k(this,wt),k(this,ft),p(this,nt,null),p(this,mt,!1),this.update=()=>{requestAnimationFrame(()=>{if(!l(this,mt))try{rs(this,Jt,on).call(this),p(this,mt,!0)}catch{}})},this.destroy=()=>{var e,a;(e=l(this,et))==null||e.unBind(),(a=l(this,et))==null||a.removeEvent(l(this,T)),l(this,T).remove()},this.show=e=>{const a=e.el,s=l(this,P).get($).dom,o={ctx:l(this,P),active:e,editorDom:s,blockDom:l(this,T)},r={contextElement:a,getBoundingClientRect:()=>l(this,wt)?l(this,wt).call(this,o):a.getBoundingClientRect()},u=[tn()];if(l(this,vt)){const c=l(this,vt).call(this,o),y=en(c);u.push(y)}nn(r,l(this,T),{placement:l(this,ft)?l(this,ft).call(this,o):"left",middleware:[...u,...l(this,Wt)],...l(this,Tt)}).then(({x:c,y})=>{Object.assign(l(this,T).style,{left:`${c}px`,top:`${y}px`}),l(this,T).dataset.show="true"})},this.hide=()=>{l(this,T).dataset.show="false"},p(this,P,t.ctx),p(this,T,t.content),p(this,vt,t.getOffset),p(this,wt,t.getPosition),p(this,ft,t.getPlacement),p(this,Wt,t.middleware??[]),p(this,Tt,t.floatingUIOptions??{}),p(this,Pt,t.root),this.hide()}get active(){return l(this,nt)}}T=new WeakMap,P=new WeakMap,et=new WeakMap,nt=new WeakMap,Pt=new WeakMap,mt=new WeakMap,Wt=new WeakMap,Tt=new WeakMap,vt=new WeakMap,wt=new WeakMap,ft=new WeakMap,Jt=new WeakSet,on=function(){const n=l(this,P).get($);(l(this,Pt)??n.dom.parentElement??document.body).appendChild(l(this,T));const t=l(this,P).get(Zt.key);t.bind(l(this,P),e=>{e.type==="hide"?(this.hide(),p(this,nt,null)):e.type==="show"&&(this.show(e.active),p(this,nt,e.active))}),p(this,et,t),l(this,et).addEvent(l(this,T)),l(this,T).draggable=!0};const Gt=[jt,st,Zt,te];Gt.key=jt.key;Gt.pluginKey=te.key;var ln=n=>{throw TypeError(n)},ee=(n,t,e)=>t.has(n)||ln("Cannot "+e),E=(n,t,e)=>(ee(n,t,"read from private field"),t.get(n)),H=(n,t,e)=>t.has(n)?ln("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),x=(n,t,e,a)=>(ee(n,t,"write to private field"),t.set(n,e),e),ws=(n,t,e)=>(ee(n,t,"access private method"),e);function fs(n){const t=Mt({},`${n}_SLASH_SPEC`),e=Qe(s=>{const o=s.get(t.key);return new Xe({key:new Ye(`${n}_SLASH`),...o})}),a=[t,e];return a.key=t.key,a.pluginKey=e.key,t.meta={package:"@milkdown/plugin-slash",displayName:`Ctx<slashSpec>|${n}`},e.meta={package:"@milkdown/plugin-slash",displayName:`Prose<slash>|${n}`},a}var kt,St,Et,Bt,Ht,tt,xt,Rt,At,Qt,rn;class ks{constructor(t){H(this,Qt),H(this,kt),H(this,St),H(this,Et),H(this,Bt),H(this,Ht),H(this,tt),H(this,xt),H(this,Rt),H(this,At),x(this,kt,!1),this.onShow=()=>{},this.onHide=()=>{},x(this,At,(e,a)=>{const{state:s,composing:o}=e,{selection:r,doc:u}=s,{ranges:c}=r,y=Math.min(...c.map(C=>C.$from.pos)),_=Math.max(...c.map(C=>C.$to.pos)),b=a&&a.doc.eq(u)&&a.selection.eq(r);if(E(this,kt)||((E(this,Bt)??e.dom.parentElement??document.body).appendChild(this.element),x(this,kt,!0)),!(o||b)){if(!E(this,xt).call(this,e,a)){this.hide();return}nn({getBoundingClientRect:()=>Yn(e,y,_)},this.element,{placement:"bottom-start",middleware:[tn(),en(E(this,Rt)),...E(this,St)],...E(this,Et)}).then(({x:C,y:M})=>{Object.assign(this.element.style,{left:`${C}px`,top:`${M}px`})}),this.show()}}),this.update=(e,a)=>{Jn(E(this,At),E(this,Ht))(e,a)},this.getContent=(e,a=s=>s.type.name==="paragraph")=>{const{selection:s}=e.state,{empty:o,$from:r}=s,u=e.state.selection instanceof Yt,c=this.element.contains(document.activeElement),y=!e.hasFocus()&&!c,_=!e.editable,b=!Qn(a)(e.state.selection);if(!(y||_||!o||!u||b))return r.parent.textBetween(Math.max(0,r.parentOffset-500),r.parentOffset,void 0,"ï¿¼")},this.destroy=()=>{},this.show=()=>{this.element.dataset.show="true",this.onShow()},this.hide=()=>{this.element.dataset.show="false",this.onHide()},this.element=t.content,x(this,Ht,t.debounce??200),x(this,xt,t.shouldShow??ws(this,Qt,rn)),x(this,tt,t.trigger??"/"),x(this,Rt,t.offset),x(this,St,t.middleware??[]),x(this,Et,t.floatingUIOptions??{}),x(this,Bt,t.root)}}kt=new WeakMap,St=new WeakMap,Et=new WeakMap,Bt=new WeakMap,Ht=new WeakMap,tt=new WeakMap,xt=new WeakMap,Rt=new WeakMap,At=new WeakMap,Qt=new WeakSet,rn=function(n){const t=this.getContent(n);if(!t)return!1;const e=t.at(-1);return e?Array.isArray(E(this,tt))?E(this,tt).includes(e):E(this,tt)===e:!1};function Ft(n){const{$from:t,$to:e}=n.selection,{pos:a}=t,{pos:s}=e;return n=n.deleteRange(a-t.node().content.size,s),n}function ys(n,t,e=null){const{from:a,to:s}=n.selection;return n.setBlockType(a,s,t,e)}function Ms(n,t,e=null){const{$from:a,$to:s}=n.selection,o=a.blockRange(s),r=o&&os(o,t,e);return r?n.wrap(o,r):null}function bs(n,t,e=null){const a=t.createAndFill(e);return a?n.replaceSelectionWith(a):null}function F(n,t=null){return(e,a)=>{if(a){const s=ys(Ft(e.tr),n,t);a(s.scrollIntoView())}return!0}}function gt(n,t=null){return(e,a)=>{const s=Ms(Ft(e.tr),n,t);return s?(a&&a(s.scrollIntoView()),!0):!1}}function $t(n,t=null){return(e,a)=>{const s=bs(Ft(e.tr),n,t);return s?(a&&a(s.scrollIntoView()),!0):!1}}var dn=n=>{throw TypeError(n)},cn=(n,t,e)=>t.has(n)||dn("Cannot "+e),lt=(n,t,e)=>(cn(n,t,"read from private field"),e?e.call(n):t.get(n)),Ke=(n,t,e)=>t.has(n)?dn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),_s=(n,t,e,a)=>(cn(n,t,"write to private field"),t.set(n,e),e),Z,Dt;class gs{constructor(){Ke(this,Z,[]),this.clear=()=>(_s(this,Z,[]),this),Ke(this,Dt,t=>{const e={group:t,addItem:(a,s)=>{const o={key:a,...s};return t.items.push(o),e},clear:()=>(t.items=[],e)};return e}),this.addGroup=(t,e)=>{const s={key:t,label:e,items:[]};return lt(this,Z).push(s),lt(this,Dt).call(this,s)},this.getGroup=t=>{const e=lt(this,Z).find(a=>a.key===t);if(!e)throw new Error(`Group with key ${t} not found`);return lt(this,Dt).call(this,e)},this.build=()=>lt(this,Z)}}Z=new WeakMap;Dt=new WeakMap;function $s(n,t,e){var a,s,o,r,u,c,y,_,b,C,M,W,N,G,bt,m,d,f,L,B,se,ae,oe,le,ie,re,de,ce,ue,he,pe,me,ve,we,fe,ke,ye,Me,be,_e,ge,$e,Ce,Ie,Le,We,Te,Se,Ee,Be,He,xe;const Re=e==null?void 0:e.get(Xn),Mn=Re==null?void 0:Re.includes(Zn.Latex),at=new gs;at.addGroup("text",(a=t==null?void 0:t.slashMenuTextGroupLabel)!=null?a:"Text").addItem("text",{label:(s=t==null?void 0:t.slashMenuTextGroupLabel)!=null?s:"Text",icon:(r=(o=t==null?void 0:t.slashMenuTextIcon)==null?void 0:o.call(t))!=null?r:Sn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(je.type(i))(w,v)}}).addItem("h1",{label:(u=t==null?void 0:t.slashMenuH1Label)!=null?u:"Heading 1",icon:(y=(c=t==null?void 0:t.slashMenuH1Icon)==null?void 0:c.call(t))!=null?y:En,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:1})(w,v)}}).addItem("h2",{label:(_=t==null?void 0:t.slashMenuH2Label)!=null?_:"Heading 2",icon:(C=(b=t==null?void 0:t.slashMenuH2Icon)==null?void 0:b.call(t))!=null?C:Bn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:2})(w,v)}}).addItem("h3",{label:(M=t==null?void 0:t.slashMenuH3Label)!=null?M:"Heading 3",icon:(N=(W=t==null?void 0:t.slashMenuH3Icon)==null?void 0:W.call(t))!=null?N:Hn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:3})(w,v)}}).addItem("h4",{label:(G=t==null?void 0:t.slashMenuH4Label)!=null?G:"Heading 4",icon:(m=(bt=t==null?void 0:t.slashMenuH4Icon)==null?void 0:bt.call(t))!=null?m:xn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:4})(w,v)}}).addItem("h5",{label:(d=t==null?void 0:t.slashMenuH5Label)!=null?d:"Heading 5",icon:(L=(f=t==null?void 0:t.slashMenuH5Icon)==null?void 0:f.call(t))!=null?L:Rn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:5})(w,v)}}).addItem("h6",{label:(B=t==null?void 0:t.slashMenuH6Label)!=null?B:"Heading 6",icon:(ae=(se=t==null?void 0:t.slashMenuH6Icon)==null?void 0:se.call(t))!=null?ae:An,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;F(U.type(i),{level:6})(w,v)}}).addItem("quote",{label:(oe=t==null?void 0:t.slashMenuQuoteLabel)!=null?oe:"Quote",icon:(ie=(le=t==null?void 0:t.slashMenuQuoteIcon)==null?void 0:le.call(t))!=null?ie:Dn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;gt(jn.type(i))(w,v)}}).addItem("divider",{label:(re=t==null?void 0:t.slashMenuDividerLabel)!=null?re:"Divider",icon:(ce=(de=t==null?void 0:t.slashMenuDividerIcon)==null?void 0:de.call(t))!=null?ce:On,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;$t(ts.type(i))(w,v)}}),at.addGroup("list",(ue=t==null?void 0:t.slashMenuListGroupLabel)!=null?ue:"List").addItem("bullet-list",{label:(he=t==null?void 0:t.slashMenuBulletListLabel)!=null?he:"Bullet List",icon:(me=(pe=t==null?void 0:t.slashMenuBulletListIcon)==null?void 0:pe.call(t))!=null?me:Pn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;gt(es.type(i))(w,v)}}).addItem("ordered-list",{label:(ve=t==null?void 0:t.slashMenuOrderedListLabel)!=null?ve:"Ordered List",icon:(fe=(we=t==null?void 0:t.slashMenuOrderedListIcon)==null?void 0:we.call(t))!=null?fe:Nn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;gt(ns.type(i))(w,v)}}).addItem("todo-list",{label:(ke=t==null?void 0:t.slashMenuTaskListLabel)!=null?ke:"Todo List",icon:(Me=(ye=t==null?void 0:t.slashMenuTaskListIcon)==null?void 0:ye.call(t))!=null?Me:Gn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;gt(ss.type(i),{checked:!1})(w,v)}});const bn=at.addGroup("advanced",(be=t==null?void 0:t.slashMenuAdvancedGroupLabel)!=null?be:"Advanced").addItem("image",{label:(_e=t==null?void 0:t.slashMenuImageLabel)!=null?_e:"Image",icon:($e=(ge=t==null?void 0:t.slashMenuImageIcon)==null?void 0:ge.call(t))!=null?$e:Fn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;$t(is.type(i))(w,v)}}).addItem("code",{label:(Ce=t==null?void 0:t.slashMenuCodeBlockLabel)!=null?Ce:"Code",icon:(Le=(Ie=t==null?void 0:t.slashMenuCodeBlockIcon)==null?void 0:Ie.call(t))!=null?Le:qn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;$t(Ge.type(i))(w,v)}}).addItem("table",{label:(We=t==null?void 0:t.slashMenuTableLabel)!=null?We:"Table",icon:(Se=(Te=t==null?void 0:t.slashMenuTableIcon)==null?void 0:Te.call(t))!=null?Se:zn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;let{tr:g}=w;g=Ft(g);const qt=g.selection.from,_n=as(i,3,3);g=g.replaceSelectionWith(_n),v(g),requestAnimationFrame(()=>{const De=h.state.doc.content.size,gn=h.state.doc.resolve(qt>De?De:qt<0?0:qt),$n=Yt.near(gn),Oe=h.state.tr;Oe.setSelection($n),v(Oe.scrollIntoView())})}});Mn&&bn.addItem("math",{label:(Ee=t==null?void 0:t.slashMenuMathLabel)!=null?Ee:"Math",icon:(He=(Be=t==null?void 0:t.slashMenuMathIcon)==null?void 0:Be.call(t))!=null?He:Kn,onRun:i=>{const h=i.get($),{dispatch:v,state:w}=h;$t(Ge.type(i),{language:"LaTex"})(w,v)}}),(xe=t==null?void 0:t.buildMenu)==null||xe.call(t,at);let ot=at.build();n&&(ot=ot.map(i=>{const h=i.items.filter(v=>v.label.toLowerCase().includes(n.toLowerCase()));return{...i,items:h}}).filter(i=>i.items.length>0));const Ae=ot.flatMap(i=>i.items);return Ae.forEach((i,h)=>{Object.assign(i,{index:h})}),ot.reduce((i,h)=>{const v=i+h.items.length;return Object.assign(h,{range:[i,v]}),v},0),{groups:ot,size:Ae.length}}const un=({show:n,hide:t,ctx:e,filter:a,config:s})=>{const{groups:o,size:r}=Pe(()=>$s(a,s,e),[a]),u=Tn(),[c,y]=Vn(0),_=Pe(()=>u.current.getRootNode(),[u]),b=Je({x:-999,y:-999}),C=V(m=>{const d=b.current;if(!d)return;const{x:f,y:L}=m;d.x=f,d.y=L},[]);Ut(()=>{r===0&&n?t==null||t():c>=r&&y(0)},[r,n]);const M=V((m,d)=>{y(f=>{const L=typeof m=="function"?m(f):m;return d==null||d(L),L})},[]),W=V(m=>{const d=u.current.querySelector(`[data-index="${m}"]`),f=u.current.querySelector(".menu-groups");!d||!f||(f.scrollTop=d.offsetTop-f.offsetTop)},[]),N=V(m=>{const d=o.flatMap(f=>f.items).at(m);d&&e&&d.onRun(e),t==null||t()},[o]),G=V(m=>{if(m.key==="Escape"){m.preventDefault(),t==null||t();return}if(m.key==="ArrowDown")return m.preventDefault(),M(d=>d<r-1?d+1:d,W);if(m.key==="ArrowUp")return m.preventDefault(),M(d=>d<=0?d:d-1,W);if(m.key==="ArrowLeft")return m.preventDefault(),M(d=>{const f=o.find(B=>B.range[0]<=d&&B.range[1]>d);if(!f)return d;const L=o[o.indexOf(f)-1];return L?L.range[1]-1:d},W);if(m.key==="ArrowRight")return m.preventDefault(),M(d=>{const f=o.find(B=>B.range[0]<=d&&B.range[1]>d);if(!f)return d;const L=o[o.indexOf(f)+1];return L?L.range[0]:d},W);m.key==="Enter"&&(m.preventDefault(),N(c))},[t,o,c]),bt=V(m=>d=>{const f=b.current;if(!f)return;const{x:L,y:B}=d;L===f.x&&B===f.y||M(m)},[]);return Ut(()=>(n?_.addEventListener("keydown",G,{capture:!0}):_.removeEventListener("keydown",G,{capture:!0}),()=>{_.removeEventListener("keydown",G,{capture:!0})}),[n,G]),rt`
    <host onmousedown=${m=>m.preventDefault()}>
      <nav class="tab-group">
        <ul>
          ${o.map(m=>rt`<li
                key=${m.key}
                onmousedown=${()=>M(m.range[0],W)}
                class=${c>=m.range[0]&&c<m.range[1]?"selected":""}
              >
                ${m.label}
              </li>`)}
        </ul>
      </nav>
      <div class="menu-groups" onmousemove=${C}>
        ${o.map(m=>rt`
            <div key=${m.key} class="menu-group">
              <h6>${m.label}</h6>
              <ul>
                ${m.items.map(d=>rt`<li
                      key=${d.key}
                      data-index=${d.index}
                      class=${c===d.index?"hover":""}
                      onmouseenter=${bt(d.index)}
                      onmousedown=${()=>{var f;(f=u.current.querySelector(`[data-index="${d.index}"]`))==null||f.classList.add("active")}}
                      onmouseup=${()=>{var f;(f=u.current.querySelector(`[data-index="${d.index}"]`))==null||f.classList.remove("active"),N(d.index)}}
                    >
                      ${d.icon}
                      <span>${d.label}</span>
                    </li>`)}
              </ul>
            </div>
          `)}
      </div>
    </host>
  `};un.props={ctx:Object,config:Object,show:Boolean,filter:String,hide:Function};const hn=Ue(un);var pn=n=>{throw TypeError(n)},mn=(n,t,e)=>t.has(n)||pn("Cannot "+e),I=(n,t,e)=>(mn(n,t,"read from private field"),e?e.call(n):t.get(n)),zt=(n,t,e)=>t.has(n)?pn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),it=(n,t,e,a)=>(mn(n,t,"write to private field"),t.set(n,e),e),S,O,j;const vn=fs("CREPE_MENU"),ne=Mt({show:()=>{},hide:()=>{}},"menuAPICtx");Ve("milkdown-slash-menu",hn);function Cs(n,t){n.set(vn.key,{view:e=>new Is(n,e,t)})}class Is{constructor(t,e,a){zt(this,S),zt(this,O),zt(this,j,null),this.update=o=>{I(this,O).update(o)},this.show=o=>{it(this,j,o),I(this,S).filter="",I(this,O).show()},this.hide=()=>{it(this,j,null),I(this,O).hide()},this.destroy=()=>{I(this,O).destroy(),I(this,S).remove()},it(this,S,new hn),I(this,S).hide=this.hide,I(this,S).ctx=t,I(this,S).config=a;const s=this;it(this,O,new ks({content:I(this,S),debounce:20,shouldShow(o){if(Cn(o.state.selection)||In(o.state.selection))return!1;const r=this.getContent(o,c=>["paragraph","heading"].includes(c.type.name));if(r==null)return!1;const u=I(s,j);return I(s,S).filter=r.startsWith("/")?r.slice(1):r,typeof u=="number"?o.state.doc.resolve(u).node()!==o.state.doc.resolve(o.state.selection.from).node()?(it(s,j,null),!1):!0:!!r.startsWith("/")},offset:10})),I(this,O).onShow=()=>{I(this,S).show=!0},I(this,O).onHide=()=>{I(this,S).show=!1},this.update(e),t.set(ne.key,{show:o=>this.show(o),hide:()=>this.hide()})}}S=new WeakMap;O=new WeakMap;j=new WeakMap;const wn=({onAdd:n,addIcon:t,handleIcon:e})=>{const a=Je();return Ut(()=>{var r;(r=a.current)==null||r.classList.remove("active")}),rt`
    <host>
      <div
        ref=${a}
        onmousedown=${r=>{var u;r.preventDefault(),r.stopPropagation(),(u=a.current)==null||u.classList.add("active")}}
        onmouseup=${r=>{var u;r.preventDefault(),r.stopPropagation(),n==null||n(),(u=a.current)==null||u.classList.remove("active")}}
        class="operation-item"
      >
        ${(t==null?void 0:t())||Ln}
      </div>
      <div class="operation-item">${(e==null?void 0:e())||Wn}</div>
    </host>
  `};wn.props={show:Boolean,onAdd:Function,addIcon:Function,handleIcon:Function};const fn=Ue(wn);var kn=n=>{throw TypeError(n)},yn=(n,t,e)=>t.has(n)||kn("Cannot "+e),D=(n,t,e)=>(yn(n,t,"read from private field"),e?e.call(n):t.get(n)),Kt=(n,t,e)=>t.has(n)?kn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),Vt=(n,t,e,a)=>(yn(n,t,"write to private field"),t.set(n,e),e),z,K,Ot;class Ls{constructor(t,e){Kt(this,z),Kt(this,K),Kt(this,Ot),this.update=()=>{D(this,K).update()},this.destroy=()=>{D(this,K).destroy(),D(this,z).remove()},this.onAdd=()=>{const s=D(this,Ot),o=s.get($);o.hasFocus()||o.focus();const{state:r,dispatch:u}=o,c=D(this,K).active;if(!c)return;const _=c.$pos.pos+c.node.nodeSize;let b=r.tr.insert(_,je.type(s).create());b=b.setSelection(Yt.near(b.doc.resolve(_))),u(b.scrollIntoView()),D(this,K).hide(),s.get(ne.key).show(b.selection.from)},Vt(this,Ot,t);const a=new fn;Vt(this,z,a),D(this,z).onAdd=this.onAdd,D(this,z).addIcon=e==null?void 0:e.handleAddIcon,D(this,z).handleIcon=e==null?void 0:e.handleDragIcon,Vt(this,K,new vs({ctx:t,content:a,getOffset:()=>16,getPlacement:({active:s,blockDom:o})=>{if(s.node.type.name==="heading")return"left";let r=0;s.node.descendants(N=>{r+=N.childCount});const u=s.el,c=u.getBoundingClientRect(),y=o.getBoundingClientRect(),_=window.getComputedStyle(u),b=Number.parseInt(_.paddingTop,10)||0,C=Number.parseInt(_.paddingBottom,10)||0,M=c.height-b-C,W=y.height;return r>2||W<M?"left-start":"left"}})),this.update()}}z=new WeakMap;K=new WeakMap;Ot=new WeakMap;Ve("milkdown-block-handle",fn);function Ws(n,t){n.set(st.key,{filterNodes:e=>!Ze(s=>["table","blockquote","math_inline"].includes(s.type.name))(e)}),n.set(Gt.key,{view:()=>new Ls(n,t)})}const Os=(n,t)=>{n.config(e=>Ws(e,t)).config(e=>Cs(e,t)).use(ne).use(Gt).use(vn)};export{Os as defineFeature};
